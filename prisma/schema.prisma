generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

generator zero {
  provider = "prisma-zero"
}

datasource db {
  provider = "postgresql"
  schemas  = ["public"]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model group_members {
  id        String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  group_id  String    @db.Uuid
  user_id   String    @db.Uuid
  joined_at DateTime? @default(now()) @db.Timestamptz(6)
  role      String?   @default("member")
  groups    groups    @relation(fields: [group_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users     users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([group_id, user_id])
  @@index([group_id], map: "idx_group_members_group_id")
  @@index([group_id, user_id], map: "idx_group_members_group_user")
  @@index([user_id], map: "idx_group_members_user_id")
  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model groups {
  id            String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name          String
  description   String?
  is_default    Boolean?        @default(false)
  created_at    DateTime?       @default(now()) @db.Timestamptz(6)
  group_members group_members[]
  messages      messages[]

  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model messages {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  group_id   String    @db.Uuid
  user_id    String    @db.Uuid
  content    String
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  groups     groups    @relation(fields: [group_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users      users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([created_at(sort: Desc)], map: "idx_messages_created_at")
  @@index([group_id, created_at(sort: Desc)], map: "idx_messages_group_created")
  @@index([group_id], map: "idx_messages_group_id")
  @@index([user_id], map: "idx_messages_user_id")
  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model users {
  id            String          @id @db.Uuid
  username      String?
  email         String?
  avatar_url    String?
  created_at    DateTime?       @default(now()) @db.Timestamptz(6)
  group_members group_members[]
  messages      messages[]

  @@schema("public")
}
