# Monorepo 改造计划

本计划旨在将当前项目结构改造为 Monorepo 结构，遵循标准的 `apps/` 和 `packages/` 目录组织方式。

## 1. 目录结构调整

将当前根目录下的应用代码移动到 `apps/web` 目录中。
保留根目录下的配置文件（如 `.gitignore`, `.npmrc` 等）并根据需要进行调整。

### 拟定结构：

```text
/
├── apps/
│   └── web/ (原项目代码)
│       ├── src/
│       ├── public/
│       ├── prisma/
│       ├── next.config.mjs
│       ├── tsconfig.json
│       ├── package.json
│       └── ...
├── packages/ (新建，用于存放共享库)
├── package.json (根目录，管理工作区)
├── pnpm-workspace.yaml (定义工作区)
└── .npmrc, .gitignore, etc.
```

## 2. 具体执行步骤

### Step 1: 准备工作

1. **备份关键文件**：确保 `package.json`、`pnpm-workspace.yaml` (如果已存在)、`.env` 等文件内容已确认。
2. **创建目录**：创建 `apps` 和 `packages` 目录。

### Step 2: 迁移应用代码

1. **创建** **`apps/web`**。
2. **移动文件**：将以下文件/目录移动到 `apps/web`：

   * `src/`

   * `public/`

   * `prisma/`

   * `docs/`

   * `next.config.mjs`

   * `tsconfig.json`

   * `Dockerfile`

   * `.dockerignore`

   * `.eslintrc.json`

   * `README.MD`

   * `bot.ts`, `ch.ts`, `chs.ts`, `index.html`, `prisma.config.ts` (及其他项目特定文件)

   * **注意**：`.env` 文件也应移动到 `apps/web`，或者在根目录保留一份并通过脚本链接，通常建议应用私有环境变量放在应用目录下。暂时移动到 `apps/web`。
3. **处理** **`package.json`**：

   * 将根目录的 `package.json` 移动到 `apps/web/package.json`。

   * 修改 `apps/web/package.json` 的 `name` 字段，例如改为 `@project/web` 或保持原名但确保唯一性。

### Step 3: 配置根目录

1. **创建根** **`package.json`**：

   * 初始化一个新的 `package.json`，设置 `private: true`。

   * 配置 `scripts`，例如 `dev`, `build` 等，转发命令到 `apps/web` 或使用 `pnpm -r`。
2. **配置** **`pnpm-workspace.yaml`**：

   * 确保内容包含：

     ```yaml
     packages:
       - 'apps/*'
       - 'packages/*'
     ```

### Step 4: 验证与调整

1. **检查依赖**：在根目录运行 `pnpm install`，确保工作区依赖链接正确。
2. **运行项目**：尝试在 `apps/web` 下运行 `pnpm dev`，验证项目是否正常启动。
3. **调整路径**：检查是否有对根目录的相对路径引用（如 `../../`），并进行修正。

## 3. 后续建议

* 可以将通用的 UI 组件、工具函数（如 `src/utils`）、类型定义（`src/interfaces`）等抽取到 `packages/` 下的独立包中，实现真正的 Monorepo 优势。

* 配置 TurboRepo 或 Nx 以优化构建缓存（可选）。

是否确认执行此改造计划？
