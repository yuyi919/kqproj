## 聊天窗口优化计划：乐观更新与增量同步

### 1. 引入 React Query 工具
- 引入 `useQueryClient` 用于直接操作缓存，实现非重绘式的增量更新。

### 2. 优化 `onLiveEvent` 实现增量同步
- **逻辑重构**：不再调用 `query$.refetch()`，而是根据事件类型更新缓存：
  - **`created`**：将新消息追加到当前列表末尾。
  - **`updated`**：定位并替换缓存中的消息内容。
  - **`deleted`**：从列表中移除对应 ID 的消息。
- **数据一致性**：
  - 在更新前校验 `group_id` 是否匹配当前窗口。
  - 增加去重逻辑，防止由于网络重试导致的重复显示。
  - 同步更新 `total` 计数以保持 Refine 状态正确。

### 3. 实现发送消息的乐观更新 (Optimistic UI)
- **拦截发送操作**：在 `createMessage` 调用前，手动向缓存中插入一条“临时消息”：
  - 生成临时 ID（如 `pending-${Date.now()}`）。
  - 设置状态为 `pending`。
- **状态回滚与对照**：
  - 如果发送失败，从缓存中移除该临时消息并显示错误提示。
  - 如果发送成功，用服务端返回的真实数据替换掉临时消息。

### 4. 增强 UI 反馈
- 扩展消息类型，支持 `status` 状态（发送中、成功、失败）。
- 在 Ant Design X 的 `Bubble` 组件中展示不同的状态反馈。

### 5. 性能优化
- 使用 `queryClient.setQueriesData` 进行模糊匹配更新，确保所有相关的消息列表查询（如不同排序或分页）都能得到准确实时的反馈。
- 减少不必要的组件重渲染。

是否开始执行此优化方案？
