# GameRoomClient 组件拆分重构计划

本计划旨在遵循关注点分离 (SoC) 原则，将庞大的 `GameRoomClient` 拆分为职责单一的子组件，以提升可维护性和后续开发效率。

## 1. 类型定义提取 (Type Extraction)

为了避免组件间的循环依赖并提高代码复用性，我们将优先提取共享接口。

-   **新建文件**: `apps/web/src/interfaces/game-room.ts` (为避免与现有 `game.ts` 混淆，使用更具体的命名)
-   **迁移内容**:
    -   `IGameRoom` 接口
    -   `IGamePlayer` 接口
    -   `GameRoomStatus` (如有)
    -   `GamePlayerStatus` (如有)

## 2. 组件拆分 (Component Splitting)

我们将采用 **容器/展示 (Container/Presentational)** 模式进行拆分。

### A. 子组件 1: `GameLobby` (等待大厅)
-   **文件**: `apps/web/src/components/game/GameRoom/GameLobby.tsx`
-   **职责**: 处理游戏开始前的等待、准备、玩家列表展示及房主控制。
-   **Props**:
    -   `room`: `IGameRoom` (包含玩家列表)
    -   `userId`: `string` (当前用户ID)
    -   `onLeave`: `() => void` (处理离开逻辑)
-   **内部逻辑**:
    -   `toggleReady` Mutation
    -   `startGame` Mutation
    -   玩家列表渲染与状态展示 (Ready/Waiting/Host)
    -   房间信息展示与复制 ID

### B. 子组件 2: `GameBoard` (游戏盘面)
-   **文件**: `apps/web/src/components/game/GameRoom/GameBoard.tsx`
-   **职责**: 处理游戏进行中 (`PLAYING`) 和结束 (`FINISHED`) 的状态。
-   **Props**:
    -   `room`: `IGameRoom`
    -   `userId`: `string`
    -   `onLeave`: `() => void`
-   **内部逻辑**:
    -   当前仅渲染占位符，预留给后续 `boardgame.io` 或自定义引擎集成。
    -   支持中途退出 (Surrender/Leave)。

### C. 容器组件: `GameRoomClient` (重构)
-   **文件**: `apps/web/src/components/game/GameRoom/GameRoomClient.tsx`
-   **职责**:
    -   数据获取 (`useOne`, `useGetIdentity`)。
    -   状态分发 (根据 `status` 切换组件)。
    -   通用逻辑处理 (如 `handleLeave`，因其涉及路由跳转，适合在顶层处理)。
-   **状态映射**:
    -   `WAITING`, `DESTROYED` -> `<GameLobby />`
    -   `PLAYING`, `FINISHED` -> `<GameBoard />`

## 执行步骤

1.  **创建接口文件**: 提取 `IGameRoom` 和 `IGamePlayer` 到 `apps/web/src/interfaces/game-room.ts`。
2.  **创建 `GameLobby.tsx`**: 将原 `GameRoomClient` 中与 UI 渲染和准备/开始相关的代码迁移至此。
3.  **创建 `GameBoard.tsx`**: 封装现有的游戏占位 UI。
4.  **重构 `GameRoomClient.tsx`**: 移除 UI 代码，仅保留数据获取和路由逻辑，引入上述两个子组件。
