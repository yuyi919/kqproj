---
phase: 03-tech-debt
plan: 02
type: execute
wave: 2
depends_on: [03-01]
files_modified:
  - src/game/moves.ts
autonomous: true
requirements: [DEBT-01]
user_setup: []

must_haves:
  truths:
    - "moves.ts 不再使用 console.log"
    - "所有日志输出使用 LoggerService"
    - "日志包含上下文信息 (模块名)"
    - "LoggerService 方法返回 Effect.Effect<void>，由 wrapMove 自动执行"
  artifacts:
    - path: "src/game/moves.ts"
      provides: "游戏移动逻辑，使用日志服务"
      contains: "LoggerService"
      no_contains: "console.log"
  key_links:
    - from: "src/game/moves.ts"
      to: "src/effect/context/logger.ts"
      via: "LoggerService.info(...)"
---

<objective>
替换 src/game/moves.ts 中的 console.log 使用 LoggerService
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/03-tech-debt/03-CONTEXT.md
@src/game/moves.ts
@src/effect/context/logger.ts

# LoggerService 直接调用模式
# 使用 yield* LoggerService.info("message") 在 Effect.gen 内
</context>

<tasks>

<task type="auto">
  <name>Task 1: 导入 LoggerService 并替换 console.log</name>
  <files>src/game/moves.ts</files>
  <action>
1. 在 moves.ts 顶部导入 LoggerService:
   ```typescript
   import { LoggerService } from "../effect/context/logger";
   ```
2. 在每个使用 console.log 的函数中，用 Effect.gen 包装:
   ```typescript
   moveName: wrapMove(({ G, playerID }: MoveContext, arg: string) => {
     return Effect.gen(function*() {
       // 原有逻辑
       yield* LoggerService.info("message");
     });
   }),
   ```
3. 直接调用 `yield* LoggerService.info("message")`，无需获取 logger 实例
4. 日志前缀使用模块标识:
   - [Vote] -> vote:
   - [Attack] -> attack:
   - [Trade] -> trade:
   - [CardSelection] -> card:
5. **重要**: 不调用 Effect.runXXX，wrapMove 会自动执行
  </action>
  <verify>
1. 运行 `grep -n "console.log" src/game/moves.ts` 确认无结果
2. 运行 `bun run typecheck` 确认无类型错误
3. 运行 `bun test` 确认测试通过
  </verify>
  <done>moves.ts 中所有 console.log 已替换为 LoggerService 调用</done>
</task>

</tasks>

<verification>
- [ ] moves.ts 中无 console.log
- [ ] 使用 LoggerService 记录日志
- [ ] LoggerService 方法返回 Effect.Effect<void>，由 wrapMove 自动执行
- [ ] 测试通过
</verification>

<success_criteria>
src/game/moves.ts 使用 LoggerService 替代 console.log
</success_criteria>

<output>
完成后创建 `.planning/phases/03-tech-debt/03-02-SUMMARY.md`
</output>
