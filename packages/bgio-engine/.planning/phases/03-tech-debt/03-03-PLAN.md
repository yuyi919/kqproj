---
phase: 03-tech-debt
plan: 03
type: execute
wave: 2
depends_on: [03-01]
files_modified:
  - src/game/phases.ts
  - src/types/config.ts
  - src/game/index.ts
autonomous: true
requirements: [DEBT-02, DEBT-03]
user_setup: []

must_haves:
  truths:
    - "phases.ts 不再使用 console.log"
    - "调试模式通过配置开关控制，不再硬编码 playerID === '0'"
    - "游戏配置对象管理调试设置"
    - "LoggerService 方法返回 Effect.Effect<void>，由 wrapMove 自动执行"
  artifacts:
    - path: "src/game/phases.ts"
      provides: "游戏阶段逻辑，使用日志服务"
      contains: "LoggerService"
      no_contains: "console.log"
    - path: "src/types/config.ts"
      provides: "游戏配置接口"
      contains: "debugMode"
    - path: "src/game/index.ts"
      provides: "调试模式检查"
      no_contains: "playerID === \"0\""
  key_links:
    - from: "src/game/phases.ts"
      to: "src/effect/context/logger.ts"
      via: "LoggerService"
    - from: "src/game/index.ts"
      to: "src/types/config.ts"
      via: "config.debugMode"
---

<objective>
替换 phases.ts 中的 console.log 并移除调试模式 Player ID "0" 硬编码
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/03-tech-debt/03-CONTEXT.md
@src/game/phases.ts
@src/game/index.ts
@src/types/config.ts

# LoggerService 直接调用模式
# 使用 yield* LoggerService.info("message") 在 Effect.gen 内
</context>

<tasks>

<task type="auto">
  <name>Task 1: 创建游戏配置接口</name>
  <files>src/types/config.ts</files>
  <action>
1. 检查 src/types/config.ts 是否存在
2. 如果不存在，创建新文件
3. 定义 GameConfig 接口:
   - debugMode: boolean (default: false)
   - logLevel?: LogLevel
4. 导出默认配置和配置合并函数
5. 导入 LogLevel 从 logger.ts
  </action>
  <verify>运行 `bun run typecheck` 确认无类型错误</verify>
  <done>GameConfig 接口已创建</done>
</task>

<task type="auto">
  <name>Task 2: 替换 phases.ts 中的 console.log</name>
  <files>src/game/phases.ts</files>
  <action>
1. 在 phases.ts 顶部导入 LoggerService:
   ```typescript
   import { LoggerService } from "../effect/context/logger";
   ```
2. 在使用 console.log 的函数中，用 Effect.gen 包装:
   - 直接调用: `yield* LoggerService.info("message")`
3. 日志前缀:
   - [Phase] -> phase:
   - [VoteResult] -> voteResult:
   - [Resolution] -> resolution:
4. **重要**: 不调用 Effect.runXXX，wrapMove/wrapHook 会自动执行
  </action>
  <verify>
1. 运行 `grep -n "console.log" src/game/phases.ts` 确认无结果
2. 运行 `bun run typecheck` 确认无类型错误
  </verify>
  <done>phases.ts 中所有 console.log 已替换</done>
</task>

<task type="auto">
  <name>Task 3: 移除调试模式 Player ID 硬编码</name>
  <files>src/game/index.ts</files>
  <action>
1. 读取 src/game/index.ts 找到 playerID === "0" 位置
2. 导入 GameConfig 或使用环境变量控制调试模式
3. 替换硬编码为: `if (process.env.DEBUG_MODE === 'true' || config.debugMode)`
4. 或者: 创建 isDebugPlayer(playerID: string) 函数检查
  </action>
  <verify>
1. 运行 `grep -n 'playerID === "0"' src/game/index.ts` 确认无结果
2. 运行 `bun run typecheck` 确认无类型错误
  </verify>
  <done>调试模式不再使用硬编码 playerID</done>
</task>

</tasks>

<verification>
- [ ] phases.ts 中无 console.log
- [ ] 调试模式通过配置控制
- [ ] LoggerService 方法返回 Effect.Effect<void>，由 wrapMove 自动执行
- [ ] 测试通过
</verification>

<success_criteria>
src/game/phases.ts 使用 LoggerService，调试模式通过配置控制
</success_criteria>

<output>
完成后创建 `.planning/phases/03-tech-debt/03-03-SUMMARY.md`
</output>
